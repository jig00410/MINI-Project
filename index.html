<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalGov Connect - Welcome</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Feather Icons for UI elements -->
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        /* Custom styles to enhance the UI */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #1a202c; /* Dark slate fallback */
            overflow: hidden; /* Prevents scrollbars from appearing due to animation */
        }
        
        /* Animated Background */
        #animated-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(45deg, #2d3748, #1a202c, #4a5568);
            background-size: 400% 400%;
            animation: gradientBG 20s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Custom focus ring for better accessibility */
        .form-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        /* Hide one of the forms by default */
        #signup-form {
            display: none;
        }
        /* Glassmorphism effect for the form container */
        .form-container {
            background: rgba(17, 24, 39, 0.5); /* Darker, less transparent */
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        /* Loading spinner animation */
        .spinner {
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 2px solid #fff;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <div id="animated-bg"></div>
    <canvas id="bg-canvas" class="absolute top-0 left-0 w-full h-full z-[-1] opacity-30"></canvas>


    <div class="w-full max-w-md p-6 sm:p-8 space-y-6 rounded-2xl shadow-2xl form-container m-4">

        <!-- App Header -->
        <div class="text-center mb-4">
            <div class="flex items-center justify-center mb-4">
                 <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                <h1 class="ml-3 text-3xl font-bold text-white">LocalGov Connect</h1>
            </div>
        </div>

        <!-- Sign-in Form -->
        <div id="signin-form">
            <h2 class="text-2xl font-semibold text-center text-white mb-6">Welcome Back</h2>
            <form id="login-form" class="space-y-5" action="#" method="POST">
                <div>
                    <button type="button" class="w-full inline-flex justify-center py-3 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 transition-transform transform hover:scale-105">
                        <svg class="w-5 h-5 mr-2" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M44.5 24c0-1.5-.1-2.9-.4-4.4H24v8.5h11.5c-.5 2.8-2 5.2-4.2 6.8v5.5h7.1c4.1-3.8 6.5-9.4 6.5-16.4z" fill="#4285F4"/><path d="M24 48c6.5 0 11.9-2.1 15.9-5.7l-7.1-5.5c-2.1 1.4-4.8 2.3-7.7 2.3-5.9 0-10.9-4-12.7-9.4H4.1v5.7C8.1 42.6 15.5 48 24 48z" fill="#34A853"/><path d="M11.3 28.6c-.4-1.2-.6-2.5-.6-3.8s.2-2.6.6-3.8V15.3H4.1C2.9 18.1 2 21.4 2 24.8s.9 6.7 2.1 9.5l7.2-5.7z" fill="#FBBC05"/><path d="M24 9.8c3.5 0 6.6 1.2 9.1 3.6l6.3-6.3C35.9 2.6 30.5 0 24 0 15.5 0 8.1 5.4 4.1 12.8l7.2 5.7c1.8-5.4 6.8-9.3 12.7-9.3z" fill="#EA4335"/></svg>
                        Sign In with Google
                    </button>
                </div>
                <div class="flex items-center"><div class="flex-grow border-t border-gray-500"></div><span class="flex-shrink mx-4 text-gray-300 text-sm">OR</span><div class="flex-grow border-t border-gray-500"></div></div>
                <div class="space-y-4">
                    <input id="signin-credential" name="credential" type="text" required class="form-input bg-white/20 appearance-none rounded-md relative block w-full px-4 py-3 border border-gray-400 placeholder-gray-300 text-white focus:outline-none sm:text-sm" placeholder="Email or Mobile Number">
                    <input id="signin-password" name="password" type="password" required class="form-input bg-white/20 appearance-none rounded-md relative block w-full px-4 py-3 border border-gray-400 placeholder-gray-300 text-white focus:outline-none sm:text-sm" placeholder="Password">
                </div>
                <button id="signin-button" type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-300">
                    <span id="signin-button-text">Sign In</span>
                    <div id="signin-spinner" class="spinner hidden"></div>
                </button>
                <p class="text-center text-sm text-gray-200">Don't have an account? <a href="#" id="show-signup" class="font-medium text-blue-300 hover:text-blue-200">Sign Up</a></p>
            </form>
        </div>
        
        <!-- Signup Form -->
        <div id="signup-form">
             <h2 class="text-2xl font-semibold text-center text-white mb-6">Create Account</h2>
             <form class="space-y-5" action="#" method="POST">
                <div class="space-y-4">
                    <input id="signup-name" name="name" type="text" required class="form-input bg-white/20 appearance-none rounded-md relative block w-full px-4 py-3 border border-gray-400 placeholder-gray-300 text-white focus:outline-none sm:text-sm" placeholder="Full Name">
                    <input id="signup-email" name="email" type="email" required class="form-input bg-white/20 appearance-none rounded-md relative block w-full px-4 py-3 border border-gray-400 placeholder-gray-300 text-white focus:outline-none sm:text-sm" placeholder="Email Address">
                    <input id="signup-password" name="password" type="password" required class="form-input bg-white/20 appearance-none rounded-md relative block w-full px-4 py-3 border border-gray-400 placeholder-gray-300 text-white focus:outline-none sm:text-sm" placeholder="Password">
                </div>
                
                <!-- Gemini API Feature: AI-Assisted Report Drafting -->
                <div class="bg-white/10 p-4 rounded-lg text-white">
                    <h3 class="text-sm font-bold mb-2">âœ¨ Apni Pehli Report Likhne Mein Madad Payein</h3>
                    <p class="text-xs text-gray-300 mb-3">Samasya ke baare mein kuch shabd likhein, aur AI aapko report draft karne mein madad karega.</p>
                    <div class="flex space-x-2">
                        <input id="issue-keywords" type="text" class="form-input bg-white/20 appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-400 placeholder-gray-300 text-white focus:outline-none sm:text-sm" placeholder="Jaise: market ke paas kachra">
                        <button id="draft-report-btn" type="button" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-md text-sm font-medium flex items-center justify-center w-24">
                            <span id="draft-btn-text">Draft</span>
                            <div id="draft-spinner" class="spinner hidden" style="width: 16px; height: 16px; border-width: 2px;"></div>
                        </button>
                    </div>
                    <div id="draft-output-container" class="hidden mt-3">
                        <textarea id="draft-output" readonly class="form-input bg-gray-900/30 appearance-none rounded-md relative block w-full p-3 h-32 border border-gray-400 text-gray-200 text-sm"></textarea>
                        <button id="copy-draft-btn" type="button" class="w-full mt-2 text-center py-2 px-4 border border-transparent text-xs font-medium rounded-md text-white bg-gray-600 hover:bg-gray-700">Copy Draft</button>
                    </div>
                </div>

                <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">Create Account</button>
                <p class="text-center text-sm text-gray-200">Pehle se account hai? <a href="#" id="show-signin" class="font-medium text-blue-300 hover:text-blue-200">Sign In</a></p>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- ICON REPLACEMENT ---
            feather.replace();

            // --- THEMED ANIMATED CANVAS BACKGROUND SCRIPT ---
            const canvas = document.getElementById('bg-canvas');
            const ctx = canvas.getContext('2d');
            let particles = [];
            
            // Define drawing functions for each icon
            const iconDrawers = [
                // Pothole
                (ctx, x, y, size) => {
                    ctx.strokeStyle = '#a0aec0'; // Muted Gray
                    ctx.lineWidth = size / 10;
                    ctx.beginPath();
                    ctx.arc(x, y, size / 2, 0, Math.PI * 2);
                    ctx.moveTo(x - size / 3, y - size / 3);
                    ctx.lineTo(x + size / 4, y + size / 4);
                    ctx.moveTo(x + size / 3, y - size / 4);
                    ctx.lineTo(x - size / 4, y + size / 3);
                    ctx.stroke();
                },
                // Leaking Tap
                (ctx, x, y, size) => {
                    ctx.fillStyle = '#63b3ed'; // Muted Blue
                    ctx.beginPath();
                    ctx.arc(x, y, size / 5, 0, Math.PI * 2);
                    ctx.fill();
                },
                // Garbage Bin
                (ctx, x, y, size) => {
                    ctx.strokeStyle = '#9ae6b4'; // Muted Green
                    ctx.lineWidth = size / 10;
                    ctx.strokeRect(x - size / 3, y - size / 2, size / 1.5, size);
                    ctx.beginPath();
                    ctx.moveTo(x - size/2, y - size/2);
                    ctx.lineTo(x + size/2, y - size/2);
                    ctx.stroke();
                },
                // Broken Lightbulb
                (ctx, x, y, size) => {
                    ctx.strokeStyle = '#faf089'; // Muted Yellow
                    ctx.lineWidth = size / 10;
                    ctx.beginPath();
                    ctx.arc(x, y, size / 3, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.strokeRect(x - size / 6, y + size / 3, size / 3, size / 4);
                }
            ];

            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            resizeCanvas();

            class IconParticle {
                constructor() {
                    this.x = Math.random() * canvas.width;
                    this.y = Math.random() * canvas.height;
                    this.vy = Math.random() * 0.4 + 0.1; // Slower vertical speed
                    this.size = Math.random() * 15 + 10; // Icon size
                    this.drawer = iconDrawers[Math.floor(Math.random() * iconDrawers.length)];
                }
                update() {
                    this.y += this.vy;
                    if (this.y > canvas.height + this.size) {
                        this.y = -this.size;
                        this.x = Math.random() * canvas.width;
                    }
                }
                draw() {
                    this.drawer(ctx, this.x, this.y, this.size);
                }
            }

            function createIcons() {
                particles = [];
                const iconCount = Math.floor(canvas.width / 80); // Adjust density
                for (let i = 0; i < iconCount; i++) {
                    particles.push(new IconParticle());
                }
            }
            createIcons();

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach(p => {
                    p.update();
                    p.draw();
                });
                requestAnimationFrame(animate);
            }
            animate();

            window.addEventListener('resize', () => {
                resizeCanvas();
                createIcons();
            });


            // --- FORM TOGGLE SCRIPT ---
            const signinForm = document.getElementById('signin-form');
            const signupForm = document.getElementById('signup-form');
            const showSignupBtn = document.getElementById('show-signup');
            const showSigninBtn = document.getElementById('show-signin');
            showSignupBtn.addEventListener('click', (e) => { e.preventDefault(); signinForm.style.display = 'none'; signupForm.style.display = 'block'; });
            showSigninBtn.addEventListener('click', (e) => { e.preventDefault(); signupForm.style.display = 'none'; signinForm.style.display = 'block'; });

            // --- LOGIN ANIMATION SCRIPT ---
            const loginForm = document.getElementById('login-form');
            const signinButton = document.getElementById('signin-button');
            const signinButtonText = document.getElementById('signin-button-text');
            const signinSpinner = document.getElementById('signin-spinner');

            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                signinButton.disabled = true;
                signinButtonText.textContent = 'Signing In...';
                signinSpinner.classList.remove('hidden');

                setTimeout(() => {
                    signinButton.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    signinButton.classList.add('bg-green-600');
                    signinSpinner.classList.add('hidden');
                    signinButtonText.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="mx-auto"><polyline points="20 6 9 17 4 12"></polyline></svg>`;
                    
                    // **REDIRECT TO DASHBOARD**
                    setTimeout(() => {
                        window.location.href = './dashboard.html';
                    }, 1000);

                }, 2000);
            });


            // --- GEMINI API SETUP ---
            const apiKey = ""; // API key is handled by the environment, leave blank.
            const fetchWithExponentialBackoff = async (url, options, retries = 5, delay = 1000) => {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        if (response.status === 429 && retries > 0) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                            return fetchWithExponentialBackoff(url, options, retries - 1, delay * 2);
                        }
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                } catch (error) {
                    if (retries > 0) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return fetchWithExponentialBackoff(url, options, retries - 1, delay * 2);
                    } else { throw error; }
                }
            };

            // --- AI-ASSISTED REPORT DRAFTING ---
            const draftBtn = document.getElementById('draft-report-btn');
            const draftBtnText = document.getElementById('draft-btn-text');
            const draftSpinner = document.getElementById('draft-spinner');
            const issueKeywordsInput = document.getElementById('issue-keywords');
            const draftOutputContainer = document.getElementById('draft-output-container');
            const draftOutput = document.getElementById('draft-output');
            const copyDraftBtn = document.getElementById('copy-draft-btn');

            const fetchReportDraft = async () => {
                const keywords = issueKeywordsInput.value.trim();
                if (!keywords) {
                    const prevText = issueKeywordsInput.placeholder;
                    issueKeywordsInput.placeholder = "Pehle yahan samasya likhein!";
                    setTimeout(() => { issueKeywordsInput.placeholder = prevText; }, 2000);
                    return;
                }
                draftBtnText.classList.add('hidden');
                draftSpinner.classList.remove('hidden');
                draftBtn.disabled = true;
                draftOutputContainer.classList.add('hidden');

                try {
                    const systemPrompt = "You are an AI assistant for LocalGov Connect. Help a citizen draft a formal, clear, and polite complaint in simple Hinglish about a civic issue to their local municipal corporation based on their keywords. The report should be well-structured and include placeholders like [Apna Naam] and [Apna Pata/Landmark] for the user to fill in. The tone should be respectful but firm.";
                    const userQuery = `Draft a detailed report for the municipal corporation based on these keywords: "${keywords}".`;
                     const result = await fetchWithExponentialBackoff(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: userQuery }] }], systemInstruction: { parts: [{ text: systemPrompt }] } })
                    });
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (text) {
                        draftOutput.value = text;
                        draftOutputContainer.classList.remove('hidden');
                    } else {
                        throw new Error("Invalid response from API.");
                    }
                } catch (error) {
                    draftOutput.value = "Maaf kijiye, hum report draft nahi kar paaye. Kripya dobara koshish karein.";
                    draftOutputContainer.classList.remove('hidden');
                } finally {
                    draftBtnText.classList.remove('hidden');
                    draftSpinner.classList.add('hidden');
                    draftBtn.disabled = false;
                }
            };

            draftBtn.addEventListener('click', fetchReportDraft);
            
            copyDraftBtn.addEventListener('click', () => {
                draftOutput.select();
                document.execCommand('copy');
                copyDraftBtn.textContent = 'Copied!';
                setTimeout(() => { copyDraftBtn.textContent = 'Copy Draft'; }, 2000);
            });
        });
    </script>

</body>
</html>

